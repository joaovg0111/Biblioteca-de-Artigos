{% extends "admin/base.html" %}
{% load i18n static %}

{% block extrastyle %}
    {{ block.super }}
    <!-- Estilos Aprimorados para o Modo Escuro do Admin -->
    <style>
        /* CORREÇÃO: Força a barra de rolagem a estar sempre visível para evitar o deslocamento do layout */
        html {
            overflow-y: scroll;
        }

        /* Define as variáveis de cor para o novo tema escuro, alinhado com o frontend */
        :root {
            --dark-bg: #111827;         /* Fundo principal (gray-900) */
            --dark-panel-bg: #1f2937;    /* Fundo dos painéis (gray-800) */
            --dark-header-bg: #1f2937;   /* Fundo do cabeçalho (gray-800) */
            --dark-fg: #d1d5db;          /* Cor do texto principal (gray-300) */
            --dark-link: #60a5fa;         /* Cor dos links (blue-400) */
            --dark-border: #374151;      /* Cor das bordas (gray-700) */
            --dark-highlight: #374151;   /* Cor de fundo para hover/seleção */
        }

        /* --- MUDANÇA: As regras só são ativadas quando a classe 'dark' está presente --- */
        html.dark body { background: var(--dark-bg); color: var(--dark-fg); }
        html.dark #header, html.dark div.breadcrumbs { background: var(--dark-header-bg); border-bottom: 1px solid var(--dark-border); }
        html.dark #nav-sidebar { background: var(--dark-bg); }
        html.dark .module { background: var(--dark-panel-bg); border-color: var(--dark-border); }
        html.dark .module caption, html.dark .module h2, html.dark .module h3, html.dark #changelist-filter h2 {
            background: #374151; /* gray-700 */
            color: #f9fafb; /* gray-50 */
        }
        html.dark a { color: var(--dark-link); }
        html.dark a:hover { color: #93c5fd; /* blue-300 */ }
        
        /* Botões */
        html.dark .button, html.dark input[type=submit], html.dark input[type=button], html.dark a.button,
        html.dark .object-tools a.addlink {
            background: #4f46e5; /* Indigo 600 */
            color: #fff !important;
        }
        html.dark .button:hover, html.dark input[type=submit]:hover, html.dark input[type=button]:hover, html.dark a.button:hover,
        html.dark .object-tools a.addlink:hover {
            background: #6366f1; /* Indigo 500 */
        }
        html.dark .button.default, html.dark input[type=submit].default {
            background: #1d4ed8; /* Blue 700 */
        }
        html.dark .button.default:hover, html.dark input[type=submit].default:hover {
            background: #2563eb; /* Blue 600 */
        }

        /* Tabelas */
        html.dark table thead th { background: #374151; border-bottom-color: var(--dark-border); }
        html.dark .row1 { background: var(--dark-panel-bg); }
        html.dark .row2 { background: #273142; } /* Um pouco mais escuro que o painel */
        html.dark tr:hover { background: var(--dark-highlight); }
        
        /* Formulários */
        html.dark select, html.dark input, html.dark textarea {
            background: #4b5563; /* gray-600 */
            border: 1px solid #6b7280; /* gray-500 */
            color: var(--dark-fg);
        }
        html.dark .paginator, html.dark .actions { background: var(--dark-panel-bg); }

        /* Esconde o ícone de sol por padrão no modo escuro */
        html.dark #theme-toggle-light-icon { display: inline-block; }
        html.dark #theme-toggle-dark-icon { display: none; }
        
        /* Esconde o ícone de lua por padrão no modo claro */
        html:not(.dark) #theme-toggle-light-icon { display: none; }
        html:not(.dark) #theme-toggle-dark-icon { display: inline-block; }
    </style>
{% endblock %}

{# --- CORREÇÃO: Estrutura de blocos corrigida. 'branding', 'usertools', etc., são blocos de nível superior. --- #}
{% block branding %}{% endblock %}

{% block usertools %}
    <div id="user-tools">
        <!-- Botão de alternância de tema -->
        <button id="theme-toggle" type="button" style="background: none; border: none; cursor: pointer; color: #e5e7eb; margin-right: 1em; vertical-align: middle; padding: 5px; border-radius: 50%;" onmouseover="this.style.backgroundColor='#4b5563'" onmouseout="this.style.backgroundColor='transparent'">
            <svg id="theme-toggle-dark-icon" style="width: 20px; height: 20px;" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
            <svg id="theme-toggle-light-icon" style="width: 20px; height: 20px;" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-.707 10.607a1 1 0 011.414 0l.707-.707a1 1 0 111.414 1.414l-.707.707a1 1 0 01-1.414 0zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
        </button>
        {% block userlinks %}
            {% if site_url %}<a href="{{ site_url }}">{% trans 'View site' %}</a> / {% endif %}
            {% if user.is_active and user.is_staff %}
                {% url 'django-admindocs-docroot' as docsroot %}
                {% if docsroot %}<a href="{{ docsroot }}">{% trans 'Documentation' %}</a> / {% endif %}
            {% endif %}
            {% if user.has_usable_password %}<a href="{% url 'admin:password_change' %}">{% trans 'Change password' %}</a> / {% endif %}
            <form id="logout-form" method="post" action="{% url 'admin:logout' %}">{% csrf_token %}<button type="submit">{% trans 'Log out' %}</button></form>
        {% endblock %}
    </div>
{% endblock %}

{% block nav-global %}{% endblock %}

{% block footer %}
    {{ block.super }}
    <script>
        (function() {
            function applyTheme() {
                if (localStorage.getItem('color-theme') === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }
            applyTheme();
        })();
    </script>
    <script>
        window.addEventListener('load', function() {
            var themeToggleButton = document.getElementById('theme-toggle');
            if (themeToggleButton) {
                themeToggleButton.addEventListener('click', function() {
                    document.documentElement.classList.toggle('dark');
                    var isDark = document.documentElement.classList.contains('dark');
                    localStorage.setItem('color-theme', isDark ? 'dark' : 'light');
                });
            }
        });
    </script>
{% endblock %}